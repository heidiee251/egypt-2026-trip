<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <!-- Viewport è¨­å®šå„ªåŒ–ï¼šåŠ å…¥ viewport-fit=cover ä»¥é©æ‡‰å…¨è¢å¹• -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 ä¸€ç”Ÿå¿…å»åŸƒåŠè¡Œ</title>
    
    <!-- PWA / åŠ å…¥ä¸»ç•«é¢è¨­å®š -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- æ”¹ç‚º default å¯ä»¥è®“ç‹€æ…‹åˆ—èƒŒæ™¯è‡ªå‹•é©æ‡‰ï¼Œé¿å…éåº¦é€æ˜é€ æˆçš„é‡ç–Šæ„Ÿ -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Icon è¨­å®š -->
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2060/2060284.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/2060/2060284.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        fadeIn: 'fadeIn 0.5s ease-in-out',
                        spin: 'spin 1s linear infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        spin: {
                            'from': { transform: 'rotate(0deg)' },
                            'to': { transform: 'rotate(360deg)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Hide scrollbar */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* æ‰‹æ©Ÿç‰ˆå„ªåŒ–ï¼šé˜²æ­¢æ©¡çš®ç­‹æ•ˆæœèˆ‡é¸å– */
        body {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        /* é—œéµä¿®æ­£ï¼šHeader é ‚éƒ¨é–“è·æ§åˆ¶ */
        .header-safe-padding {
            padding-top: 1.5rem; 
            padding-top: calc(env(safe-area-inset-top) + 1.5rem); 
        }

        /* ğŸ”¥ åº•éƒ¨ä¿®æ­£é‡é»ï¼šæ¶ˆé™¤å¤šé¤˜ç©ºç™½
           èˆŠè¨­å®š: calc(env(...) + 0.75rem) -> å°è‡´é›™é‡ç•™ç™½
           æ–°è¨­å®š: max(0.75rem, env(...)) 
           é‚è¼¯ï¼šå¦‚æœæœ‰ Safe Area (iPhone)ï¼Œå°±ç›´æ¥ç”¨ Safe Area çš„é«˜åº¦ï¼Œä¸å†ç–ŠåŠ é¡å¤–é«˜åº¦ã€‚
                 å¦‚æœæ²’æœ‰ Safe Area (é›»è…¦/èˆŠæ‰‹æ©Ÿ)ï¼Œå‰‡ç¶­æŒ 0.75rem çš„ç¾è§€é–“è·ã€‚
        */
        .nav-safe-padding {
            padding-bottom: 0.75rem; /* Fallback */
            padding-bottom: max(0.75rem, env(safe-area-inset-bottom));
        }

        @media (min-width: 640px) {
            .header-safe-padding {
                padding-top: 3rem; 
            }
            .nav-safe-padding {
                padding-bottom: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gray-100 transition-colors duration-300 fixed inset-0 overflow-hidden w-full h-full">

    <div id="app-container" class="w-full h-full flex flex-col sm:h-[calc(100vh-64px)] sm:max-h-[900px] font-sans text-gray-800 max-w-md mx-auto relative shadow-none sm:shadow-2xl sm:rounded-2xl bg-gray-100 transition-colors duration-300 sm:my-8 border-x-0 sm:border-x border-gray-200/50">
        
        <!-- Header -->
        <header id="header" class="header-safe-padding bg-white px-6 pb-4 z-20 shadow-sm flex-none flex justify-between items-end transition-colors duration-300">
            <div>
                <h1 class="text-xl font-extrabold text-amber-600 tracking-tight leading-tight">2026<br/><span class="text-gray-800 text-2xl" id="header-subtitle">ä¸€ç”Ÿå¿…å»åŸƒåŠè¡Œ</span></h1>
                <p class="text-xs text-gray-400 font-medium tracking-widest mt-1">MYSTERY & HISTORY TOUR</p>
            </div>
            
            <div class="flex items-center gap-2">
                <!-- å­—é«”èª¿æ•´æŒ‰éˆ• -->
                <button onclick="cycleFontSize()" class="p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-all active:scale-95 flex items-center justify-center w-9 h-9 font-serif font-bold" id="font-btn" aria-label="èª¿æ•´å­—é«”å¤§å°">
                    A
                </button>
                <!-- ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• -->
                <button onclick="toggleTheme()" class="p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition-all active:scale-95 flex items-center justify-center w-9 h-9" id="theme-btn" aria-label="åˆ‡æ›æ·±è‰²æ¨¡å¼">
                    <i data-lucide="moon" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 p-4 pb-6 overflow-y-auto scrollbar-hide overscroll-contain">
            <!-- Content will be injected here by JavaScript -->
        </main>

        <!-- Bottom Navigation -->
        <nav id="bottom-nav" class="nav-safe-padding bg-white border-t border-gray-200 px-4 pt-3 z-20 flex-none flex justify-between items-center text-xs transition-colors duration-300">
            <!-- Nav items injected by JS -->
        </nav>

    </div>

    <script>
        // --- State Management ---
        const state = {
            activeTab: 'itinerary',
            darkMode: false,
            expandedDay: null,
            fontLevel: 0, // 0: é è¨­, 1: ä¸­, 2: å¤§
            currency: {
                usd: '',
                egp: '',
                twd: '',
                rates: {
                    usdToTwd: 32.5,
                    usdToEgp: 50.5
                },
                loading: false
            },
            checkedItems: new Set()
        };

        // --- Data ---
        const tripDetails = {
            dates: "2026/12/25 - 2027/01/02",
            flight: "TK690 (æŠµé”é–‹ç¾… 09:20)",
            currentPax: 15,
        };

        const itinerary = [
            {
                day: 1,
                date: "12/25 (äº”)",
                title: "æŠµé”é–‹ç¾… & èˆŠåŸå·¡ç¦®",
                stay: "é–‹ç¾…äº”æ˜Ÿç´šé…’åº—",
                highlight: "è–©æ‹‰ä¸åŸå ¡ã€æ¸…çœŸå¯ºã€å“ˆåˆ©åˆ©å¸‚é›†",
                desc: "ä¸Šåˆ11:00å‰æŠµé”é–‹ç¾…æ©Ÿå ´ã€‚è½åœ°æ¥æ©Ÿå¾Œå‰å¾€è–©æ‹‰ä¸åŸå ¡èˆ‡ç©†å“ˆé»˜å¾·é˜¿è£¡æ¸…çœŸå¯ºï¼Œåƒè§€æ‡¸ç©ºæ•™å ‚(æˆ–æ´ç©´æ•™å ‚)ï¼Œæœ€å¾Œåœ¨å“ˆåˆ©åˆ©å¸‚é›†æ„Ÿå—åŸƒåŠé¢¨æƒ…ã€‚",
                details: "è–©æ‹‰ä¸åŸå ¡æ˜¯é–‹ç¾…çš„åœ°æ¨™ä¹‹ä¸€ï¼Œå»ºæ–¼12ä¸–ç´€ï¼Œæ“æœ‰çµ•ä½³çš„è¦–é‡å¯ä¿¯ç°å…¨é–‹ç¾…ã€‚å…¶ä¸­çš„ç©†ç½•é»˜å¾·Â·é˜¿é‡Œæ¸…çœŸå¯ºä»¥å…¶å·¨å¤§çš„éŠ€è‰²åœ“é ‚å’Œé«˜è³çš„å°–å¡”èåï¼Œå…§éƒ¨è£é£¾è¯éº—ï¼Œæ˜¯å¥§æ–¯æ›¼å»ºç¯‰çš„ä»£è¡¨ä½œã€‚",
                link: "https://zh.wikipedia.org/zh-tw/%E8%90%A8%E6%8B%89%E4%B8%81%E5%9F%8E%E5%A0%A1",
                image: "https://images.unsplash.com/photo-1633104647161-267fdae94687?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", // Updated
                icon: "plane",
                meals: "éƒ¨åˆ†é¤é£Ÿ"
            },
            {
                day: 2,
                date: "12/26 (å…­)",
                title: "æ·±å…¥é»‘ç™½æ²™æ¼ ",
                stay: "æ²™æ¼ éœ²ç‡Ÿ (ç¯ç«æ™šé¤)",
                highlight: "æ°´æ™¶å±±ã€ç™½è‰²æ²™æ¼ ã€æ»‘æ²™",
                desc: "å‰å¾€å·´å“ˆåˆ©äºç¶ æ´²åˆé¤ï¼Œæ¢ç´¢å¥‡ç‰¹çš„æ°´æ™¶å±±èˆ‡é˜¿åŠ å·´ç‰¹å±±è°·ã€‚å‚æ™šåœ¨ç™½è‰²æ²™æ¼ æ»‘æ²™ï¼Œé«”é©—æ²™æ¼ éœ²ç‡Ÿèˆ‡æ˜Ÿç©ºä¸‹çš„ç¯ç«æ™šé¤ã€‚",
                details: "ç™½è‰²æ²™æ¼ ä»¥å…¶é›ªç™½çš„çš„ç™½å Šå²©åœ°å½¢èåï¼Œç¶“éé¢¨æ²™é•·å¹´ä¾µè•ï¼Œå½¢æˆäº†åƒè˜‘è‡ã€å°é›ç­‰å„ç¨®å¥‡ç‰¹å½¢ç‹€ã€‚æ™šä¸Šåœ¨ç„¡å…‰å®³çš„æ²™æ¼ ä¸­éœ²ç‡Ÿï¼Œæ˜¯è§€è³å£¯éº—éŠ€æ²³çš„çµ•ä½³æ©Ÿæœƒã€‚",
                link: "https://zh.wikipedia.org/wiki/%E7%99%BD%E6%B2%99%E6%BC%A0",
                image: "https://i0.wp.com/ninetyroadtravel.com/wp-content/uploads/2023/09/image-52.png?resize=1024%2C768&ssl=1", // Updated
                icon: "tent",
                meals: "å«æ—©é¤ã€ç¶ æ´²åˆé¤ã€ç‡Ÿåœ°æ™šé¤"
            },
            {
                day: 3,
                date: "12/27 (æ—¥)",
                title: "ç¶ æ´²ç§˜å¢ƒ & è¿”å›é–‹ç¾…",
                stay: "é–‹ç¾…äº”æ˜Ÿç´šé…’åº—",
                highlight: "é»‘æ²™æ¼ ã€ç¶ æ´²æº«æ³‰",
                desc: "äº«ç”¨æ²™æ¼ æ—©é¤å¾Œï¼Œåƒè§€é»‘æ²™æ¼ èˆ‡é«”é©—ç¶ æ´²æº«æ³‰ï¼Œäº«ç”¨ç¶ æ´²åˆé¤å¾Œè¿”å›é–‹ç¾…ã€‚",
                details: "é»‘æ²™æ¼ çš„åœ°è²Œèˆ‡ç™½æ²™æ¼ æˆªç„¶ä¸åŒï¼Œéå¸ƒè‘—é»‘è‰²ç«å±±å²©ï¼Œå‘ˆç¾å‡ºå¦‚å¤–æ˜Ÿçƒèˆ¬çš„è’æ¶¼ç¾æ„Ÿã€‚éš¨å¾Œå‰å¾€ç¶ æ´²æº«æ³‰æ”¾é¬†èº«å¿ƒï¼Œæ´—å»æ²™æ¼ çš„å¡µåœŸã€‚",
                link: "https://en.wikipedia.org/wiki/Bahariya_Oasis",
                image: "https://tings.tw/wp-content/uploads/2024/02/img_4256-1.jpg", // Updated
                icon: "bus",
                meals: "å«æ—©é¤ã€åˆé¤"
            },
            {
                day: 4,
                date: "12/28 (ä¸€)",
                title: "ç©¿è¶Šå¤ä»Šåšç‰©é¤¨æ—¥",
                stay: "é–‹ç¾…äº”æ˜Ÿç´šé…’åº—",
                highlight: "å¤§åŸƒåŠåšç‰©é¤¨ã€æ–‡æ˜åšç‰©é¤¨",
                desc: "æ—©ä¸Šåƒè§€å®å‰çš„å¤§åŸƒåŠåšç‰©é¤¨(GEM)ï¼Œä¸‹åˆå‰å¾€åŸƒåŠæ–‡æ˜åšç‰©é¤¨(NMEC)è§€çœ‹çš‡å®¶æœ¨ä¹ƒä¼Šã€‚",
                details: "å¤§åŸƒåŠåšç‰©é¤¨ (GEM) æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„è€ƒå¤åšç‰©é¤¨ï¼Œæ”¶è—äº†å®Œæ•´çš„åœ–å¦å¡é–€å¯¶è—ã€‚ä¸‹åˆçš„æ–‡æ˜åšç‰©é¤¨å‰‡å±•ç¤ºäº†å¾å²å‰åˆ°ç¾ä»£çš„åŸƒåŠæ–‡æ˜é€²ç¨‹ï¼Œæœ€è‘—åçš„å±•å»³æ”¶è—äº†22å…·çš‡å®¶æœ¨ä¹ƒä¼Šã€‚",
                link: "https://grandegyptianmuseum.org/",
                image: "https://media.vogue.com.tw/photos/65670f76d69455de2845d343/master/w_1920,c_limit/Grand%20Egyptian%20Museum%20Image.jpg", // Updated
                icon: "camera",
                meals: "éƒ¨åˆ†é¤é£Ÿ"
            },
            {
                day: 5,
                date: "12/29 (äºŒ)",
                title: "é‡‘å­—å¡”å‚³å¥‡ & é£›å¾€é˜¿æ–¯æ—º",
                stay: "é˜¿æ–¯æ—ºäº”æ˜Ÿç´šé…’åº—",
                highlight: "å‰è–©é‡‘å­—å¡”ã€ç…èº«äººé¢åƒã€é¨é§±é§",
                desc: "æ¢ç´¢ä¸–ç•Œå¥‡è¹Ÿå‰è–©é‡‘å­—å¡”ç¾¤èˆ‡ç…èº«äººé¢åƒï¼Œé«”é©—é¨é§±é§ã€‚æ™šä¸Šæ­ä¹˜åœ‹å…§èˆªç­ MS86 é£›å¾€å—éƒ¨å¤§åŸé˜¿æ–¯æ—ºã€‚",
                details: "å‰è–©é‡‘å­—å¡”ç¾¤æ˜¯å¤ä»£ä¸–ç•Œä¸ƒå¤§å¥‡è¹Ÿä¸­å”¯ä¸€ç¢©æœåƒ…å­˜çš„ï¼ŒåŒ…æ‹¬èƒ¡å¤«ã€å¡å¤«æ‹‰å’Œå­Ÿå¡æ‹‰ä¸‰åº§é‡‘å­—å¡”ã€‚ä¸€å®šè¦é«”é©—åœ¨é‡‘å­—å¡”èƒŒæ™¯ä¸‹é¨é§±é§ï¼Œæ‹å‡ºç¶“å…¸çš„äººç”Ÿç…§ç‰‡ã€‚",
                link: "https://zh.wikipedia.org/zh-tw/%E5%90%89%E8%90%A8%E9%87%91%E5%AD%97%E5%A1%94%E7%BE%A4",
                image: "https://images.unsplash.com/photo-1503177119275-0aa32b3a9368?auto=format&fit=crop&q=80&w=800",
                icon: "plane",
                meals: "éƒ¨åˆ†é¤é£Ÿ",
                isFlight: true,
                flightInfo: "åŸƒèˆª MS86 19:00 - 20:25"
            },
            {
                day: 6,
                date: "12/30 (ä¸‰)",
                title: "æ‹‰ç¾è¥¿æ–¯çš„æ¦®è€€",
                stay: "é˜¿æ–¯æ—ºäº”æ˜Ÿç´šé…’åº—",
                highlight: "é˜¿å¸ƒè¾›è²ç¥å»Ÿ (å¤§å»Ÿ+å°å»Ÿ)",
                desc: "è»Šç¨‹ç´„3.5å°æ™‚å‰å¾€é˜¿å¸ƒè¾›è²ï¼Œåƒè§€å£¯è§€çš„ç¥å»Ÿç¾¤ï¼Œéš¨å¾Œè¿”å›é˜¿æ–¯æ—ºã€‚",
                details: "é˜¿å¸ƒè¾›è²ç¥å»Ÿæ˜¯æ‹‰ç¾è¥¿æ–¯äºŒä¸–ç‚ºäº†å±•ç¤ºåœ‹åŠ›è€Œå»ºï¼Œç¥å»Ÿé–€å£å››åº§å·¨å¤§çš„æ³•è€ååƒæ¥µç‚ºéœ‡æ’¼ã€‚æ›´ç¥å¥‡çš„æ˜¯ï¼Œé€™åº§ç¥å»Ÿæ›¾å› èˆˆå»ºæ°´å£©è€Œé¢è‡¨æ·¹æ²’ï¼Œå¾Œç¶“è¯åˆåœ‹æ•™ç§‘æ–‡çµ„ç¹”æ•´é«”é·ç§»ä¿å­˜ã€‚",
                link: "https://zh.wikipedia.org/wiki/%E9%98%BF%E5%B8%83%E8%BE%9B%E8%B4%9D%E7%A5%9E%E5%BA%99",
                image: "https://images.unsplash.com/photo-1633163893862-4cdc62de7d82?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", // Updated
                icon: "sun",
                meals: "éƒ¨åˆ†é¤é£Ÿ"
            },
            {
                day: 7,
                date: "12/31 (å››)",
                title: "å°¼ç¾…æ²³é¢¨æƒ… & è·¨å¹´å¤œ",
                stay: "ç›§å…‹ç´¢äº”æ˜Ÿç´šé…’åº—",
                highlight: "è²èŠç¥å»Ÿã€åŠªæ¯”äºæ‘ã€é¢¨å¸†èˆ¹",
                desc: "æ­ä¹˜æ‘©æ‰˜èˆ¹å‰å¾€è²èŠç¥å»Ÿï¼Œåƒè¨ªè‰²å½©ç¹½ç´›çš„åŠªæ¯”äºæ‘ã€‚éš¨å¾Œå‰å¾€ç›§å…‹ç´¢æº–å‚™è·¨å¹´ã€‚",
                details: "è²èŠç¥å»Ÿä¾›å¥‰æ„›ç¥ä¼Šè¥¿æ–¯ï¼Œè¢«ç¨±ç‚ºã€Œå°¼ç¾…æ²³çš„çç ã€ï¼Œéœ€æ­èˆ¹æ‰èƒ½æŠµé”ã€‚åŠªæ¯”äºæ‘å‰‡å……æ»¿é®®è±”çš„è‰²å½©èˆ‡ç†±æƒ…çš„åŠªæ¯”äºäººï¼Œé€™è£¡ä¹Ÿæ˜¯è³¼è²·é¦™æ–™èˆ‡æ‰‹å·¥è—å“çš„å¥½åœ°æ–¹ã€‚",
                link: "https://zh.wikipedia.org/wiki/%E8%8F%B2%E8%8E%B1%E7%A5%9E%E5%BA%99",
                image: "https://images.unsplash.com/photo-1655163394526-46ce1d6761b1?q=80&w=1074&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", // Updated
                icon: "anchor",
                meals: "éƒ¨åˆ†é¤é£Ÿ"
            },
            {
                day: 8,
                date: "01/01 (äº”)",
                title: "å¤éƒ½åº•æ¯”æ–¯å·¡ç¦®",
                stay: "ç›§å…‹ç´¢äº”æ˜Ÿç´šé…’åº—",
                highlight: "å¸ç‹è°·ã€å¡ç´å…‹ç¥å»Ÿã€ç›§å…‹ç´¢ç¥å»Ÿ",
                desc: "æ–°å¹´ç¬¬ä¸€å¤©ï¼å¯è‡ªè²»åƒåŠ ç†±æ°£çƒã€‚èµ°è¨ªå¸ç‹è°·ã€é–€è¾²å·¨åƒï¼Œä»¥åŠå£¯è§€çš„å¡ç´å…‹èˆ‡ç›§å…‹ç´¢ç¥å»Ÿã€‚",
                details: "ç›§å…‹ç´¢æ˜¯å¤åŸƒåŠæ–°ç‹åœ‹æ™‚æœŸçš„é¦–éƒ½åº•æ¯”æ–¯ã€‚å¸ç‹è°·åŸ‹è‘¬äº†å¤šä½æ³•è€ï¼ˆå«åœ–å¦å¡é–€ï¼‰ã€‚å¡ç´å…‹ç¥å»Ÿæ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„ç¥å»Ÿç¾¤ä¹‹ä¸€ï¼Œå…¶å·¨å¤§çš„å¤šæŸ±å»³ä»¤äººå˜†ç‚ºè§€æ­¢ã€‚",
                link: "https://zh.wikipedia.org/wiki/%E5%BA%95%E6%AF%94%E6%96%AF_(%E5%9F%83%E5%8F%8A)",
                image: "https://images.unsplash.com/photo-1632944398987-494eebe663be?q=80&w=1171&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", // Updated
                icon: "camera",
                meals: "éƒ¨åˆ†é¤é£Ÿ"
            },
            {
                day: 9,
                date: "01/02 (å…­)",
                title: "ä¸¹é”æ‹‰ç¥å»Ÿ & è¿”ç¨‹",
                stay: "æº«æš–çš„å®¶ / æˆ–é–‹ç¾…æ©Ÿå ´å‘¨é‚Š",
                highlight: "ä¸¹é”æ‹‰ç¥å»Ÿã€åœ‹å…§èˆªç­è¿”é–‹ç¾…",
                desc: "å‰å¾€ä¸¹é”æ‹‰ç¥å»Ÿ(2hrè»Šç¨‹)ã€‚ä¸‹åˆæ­ä¹˜ MS75 è¿”å›é–‹ç¾…æ©Ÿå ´ã€‚å»ºè­°é è¨‚æ™šä¸Š 11:00 å¾Œçš„åœ‹éš›ç­æ©Ÿè¿”åœ‹ã€‚",
                details: "ä¸¹é”æ‹‰ç¥å»Ÿæ˜¯åŸƒåŠä¿å­˜æœ€å®Œå¥½çš„ç¥å»Ÿä¹‹ä¸€ï¼Œå¤©èŠ±æ¿ä¸Šè‘—åçš„ã€Œä¸¹é”æ‹‰é»ƒé“å¸¶ã€æç¹ªäº†å¤åŸƒåŠçš„å¤©æ–‡çŸ¥è­˜ï¼Œè‰²å½©é®®è±”å¦‚æ–°ã€‚",
                link: "https://zh.wikipedia.org/wiki/%E4%B8%B9%E8%BE%BE%E6%8B%89%E7%A5%9E%E5%BA%99%E7%BE%A4",
                image: "https://images.unsplash.com/photo-1723997326348-d4953661a61a?q=80&w=1332&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", // Updated
                icon: "plane",
                meals: "æ—©é¤",
                isFlight: true,
                flightInfo: "åŸƒèˆª MS75 15:20 - 16:30",
                importantNote: "æ³¨æ„ï¼šè‹¥æ‚¨æ˜¯æ­ä¹˜éš”å¤© (1/3) ä¸Šåˆæ‰é›¢é–‹é–‹ç¾…çš„èˆªç­ï¼Œè«‹å‹™å¿…è‡ªè¡Œé è¨‚ 1/2 ç•¶æ™šçš„ä½å®¿ï¼Œå»ºè­°é¸æ“‡é–‹ç¾…æ©Ÿå ´å‘¨é‚Šé£¯åº—ä»¥ä¾¿æ­æ©Ÿã€‚"
            }
        ];

        const costs = {
            tiers: [
                { pax: "14äºº", price: "2080 USD", twd: "ç´„ 6.6 è¬" },
                { pax: "16äºº", price: "2040 USD", twd: "ç´„ 6.5 è¬" },
                { pax: "18äºº", price: "1980 USD", twd: "ç´„ 6.3 è¬" }
            ],
            included: [
                "æ©Ÿå ´æ¥é€ã€æµ·é—œæ¥æ©Ÿ",
                "é–‹ç¾…äº”æ˜Ÿé…’åº—3æ™šã€é˜¿æ–¯æ—ºäº”æ˜Ÿ2æ™šã€ç›§å…‹ç´¢äº”æ˜Ÿ2æ™šã€æ²™æ¼ éœ²ç‡Ÿ1æ™š",
                "å…¨ç¨‹åŒ…è»Š (50äººåº§å·´å£«)ã€æ²¹è²»ã€éè·¯è²» (æ¯å¤©8-9å°æ™‚)",
                "æ™¯é»é¦–é“é–€ç¥¨ (å«é‡‘å­—å¡”é¨é§±é§åŠå°è²»)",
                "å‰å¾€æ™¯é»æ¥é§èˆ¹è²»ã€è»Šè²»",
                "éƒ¨åˆ†é¤é£Ÿã€æ¯æ—¥å…©ç“¶æ°´/äºº",
                "è€ƒå¤ç´šä¸­æ–‡è³‡æ·±å°éŠ (å…¨ç¨‹åŒä¸€äºº)",
                "å¸æ©Ÿèˆ‡å°éŠå°è²»"
            ],
            excluded: [
                "åœ‹éš›æ©Ÿç¥¨",
                "åŸƒåŠå…§é™¸æ©Ÿç¥¨",
                "è½åœ°ç°½ 25 USD/äºº",
                "ç†±æ°£çƒ (40~100 USDæµ®å‹•)",
                "å€‹äººæ¶ˆè²»èˆ‡é¡å¤–é¤é£²"
            ]
        };

        const guides = [
            {
                title: "å¤©æ°£èˆ‡ç©¿è‘— (12æœˆåº•-1æœˆåˆ)",
                icon: "sun",
                color: "text-orange-500",
                content: "æ—©æ™šæº«å·®æ¥µå¤§ï¼é–‹ç¾…/ç›§å…‹ç´¢ç™½å¤©ç´„ 20-23Â°C (è–„é•·è¢–/æ´‹è”¥å¼)ï¼Œæ™šä¸Šç´„ 10-12Â°C (éœ€åšå¤–å¥—)ã€‚æ²™æ¼ åœ°å€å¤œæ™šå¯é™è‡³ 0-5Â°Cï¼Œå‹™å¿…æ”œå¸¶ä¿æš–è¡£ç‰©ã€æ¯›å¸½ã€åœå·¾ã€‚"
            },
            {
                title: "é›»å£“èˆ‡æ’åº§",
                icon: "zap",
                color: "text-yellow-500",
                content: "åŸƒåŠé›»å£“ç‚º 220Vã€‚æ’åº§ç‚ºã€Œé›™åœ“å­”ã€(Type C / Fï¼Œæ­è¦)ã€‚è«‹å‹™å¿…æ”œå¸¶è¬ç”¨è½‰æ¥é ­ï¼Œè‹¥é›»å™¨ç„¡è®Šå£“åŠŸèƒ½(å¦‚å¹é¢¨æ©Ÿ)ï¼Œéœ€æ­é…è®Šå£“å™¨ä½¿ç”¨ã€‚"
            },
            {
                title: "åœ‹å…§èˆªç­è¡Œæé™åˆ¶",
                icon: "briefcase",
                color: "text-blue-500",
                content: "å› è¡Œç¨‹åŒ…å«å…©æ®µå…§é™¸é£›æ©Ÿ (é–‹ç¾…-é˜¿æ–¯æ—º / ç›§å…‹ç´¢-é–‹ç¾…)ï¼Œåš´æ ¼åŸ·è¡Œè¡Œæè¦å®šï¼šè¨—é‹é™ä¸€ä»¶ 23KG + æ‰‹æé™ä¸€ä»¶ 7KGã€‚è¶…é‡è²»æ¥µé«˜ï¼Œè«‹æ§åˆ¶è³¼ç‰©æ…¾æœ›æˆ–é ç•™ç©ºé–“ã€‚"
            },
            {
                title: "é¢¨ä¿—èˆ‡ç¦å¿Œ",
                icon: "info",
                color: "text-purple-500",
                content: "1. å°è²»(Baksheesh)æ˜¯æ–‡åŒ–ä¹Ÿæ˜¯ç¾©å‹™ï¼Œä¸Šå»æ‰€é€šå¸¸éœ€ 5-10 åŸƒéŠã€‚\n2. åƒè§€æ¸…çœŸå¯ºå¥³æ€§éœ€åŒ…é ­å·¾ï¼Œç©¿è‘—ä¸å®œéåº¦æš´éœ²ã€‚\n3. ä¸è¦éš¨æ„æ‹æ”è»è­¦äººå“¡æˆ–ç•¶åœ°å©¦å¥³ã€‚\n4. é£²ç”¨æ°´è«‹å‹™å¿…å–ç“¶è£æ°´ã€‚"
            }
        ];

        const packingList = [
            { category: "è­‰ä»¶é¡", items: ["è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)", "æ©Ÿç¥¨è­‰æ˜/é›»å­æª”", "ç¾é‡‘ç¾é‡‘ (å¤§é¢é¡æ›åŒ¯ç”¨ï¼Œå°é¢é¡ä»˜å°è²»)", "ä¿¡ç”¨å¡ (å¤§é£¯åº—/å•†å ´ç”¨)"] },
            { category: "è¡£ç‰©é¡", items: ["è¼•ç¾½çµ¨/åšå¤–å¥— (æ²™æ¼ /æ—©æ™šç”¨)", "è–„é•·è¢–ã€Tæ¤", "å¥½èµ°çš„é‹ (ç¥å»Ÿå¤šæ²™åœ°)", "é®é™½å¸½ã€å¤ªé™½çœ¼é¡", "åœå·¾ (é˜²é¢¨æ²™/é€²æ¸…çœŸå¯º)", "æ³³è¡£ (é£¯åº—æ³³æ± /æº«æ³‰)"] },
            { category: "ç”Ÿæ´»ç”¨å“", items: ["ç‰™åˆ·ç‰™è† (ç’°ä¿ä¸æä¾›)", "æ‹–é‹", "å€‹äººä¿é¤Šå“/é˜²æ›¬ä¹³ (æ¥µä¹¾ç‡¥)", "è…¸èƒƒè—¥/æ„Ÿå†’è—¥/æšˆè»Šè—¥", "æ¿•ç´™å·¾/ä¹¾æ´—æ‰‹", "è¬ç”¨è½‰æ¥é ­ (é›™åœ“å­”)"] },
            { category: "é›»å­é¡", items: ["è¡Œå‹•é›»æº (éš¨èº«æ”œå¸¶)", "å……é›»ç·š", "ç›¸æ©Ÿ/è¨˜æ†¶å¡"] }
        ];

        // --- Functions ---

        // Theme Toggle
        function toggleTheme() {
            state.darkMode = !state.darkMode;
            const container = document.getElementById('app-container');
            const header = document.getElementById('header');
            const bottomNav = document.getElementById('bottom-nav');
            const themeBtn = document.getElementById('theme-btn');
            const fontBtn = document.getElementById('font-btn');
            const subtitle = document.getElementById('header-subtitle');
            
            if (state.darkMode) {
                document.documentElement.classList.add('dark');
                container.classList.replace('bg-gray-100', 'bg-slate-900');
                container.classList.replace('text-gray-800', 'text-gray-100');
                header.classList.replace('bg-white', 'bg-slate-800');
                bottomNav.classList.replace('bg-white', 'bg-slate-800');
                bottomNav.classList.replace('border-gray-200', 'border-slate-700');
                
                // Header specifics
                themeBtn.classList.replace('bg-gray-100', 'bg-slate-700');
                themeBtn.classList.replace('text-gray-600', 'text-yellow-400');
                themeBtn.classList.replace('hover:bg-gray-200', 'hover:bg-slate-600');
                themeBtn.innerHTML = '<i data-lucide="sun" class="w-5 h-5"></i>';
                
                fontBtn.classList.replace('bg-gray-100', 'bg-slate-700');
                fontBtn.classList.replace('text-gray-600', 'text-gray-200');
                fontBtn.classList.replace('hover:bg-gray-200', 'hover:bg-slate-600');

                subtitle.classList.replace('text-gray-800', 'text-white');
            } else {
                document.documentElement.classList.remove('dark');
                container.classList.replace('bg-slate-900', 'bg-gray-100');
                container.classList.replace('text-gray-100', 'text-gray-800');
                header.classList.replace('bg-slate-800', 'bg-white');
                bottomNav.classList.replace('bg-slate-800', 'bg-white');
                bottomNav.classList.replace('border-slate-700', 'border-gray-200');

                // Header specifics
                themeBtn.classList.replace('bg-slate-700', 'bg-gray-100');
                themeBtn.classList.replace('text-yellow-400', 'text-gray-600');
                themeBtn.classList.replace('hover:bg-slate-600', 'hover:bg-gray-200');
                themeBtn.innerHTML = '<i data-lucide="moon" class="w-5 h-5"></i>';

                fontBtn.classList.replace('bg-slate-700', 'bg-gray-100');
                fontBtn.classList.replace('text-gray-200', 'text-gray-600');
                fontBtn.classList.replace('hover:bg-slate-600', 'hover:bg-gray-200');

                subtitle.classList.replace('text-white', 'text-gray-800');
            }
            render(); 
        }

        // Font Size Toggle
        function cycleFontSize() {
            state.fontLevel = (state.fontLevel + 1) % 3;
            
            // Adjust Root Font Size (influences all rem units)
            // Default 100% = 16px. 
            const sizes = ['100%', '110%', '120%'];
            document.documentElement.style.fontSize = sizes[state.fontLevel];
            
            // Visual feedback on button
            const btn = document.getElementById('font-btn');
            btn.innerHTML = state.fontLevel === 0 ? 'A' : (state.fontLevel === 1 ? 'A+' : 'A++');
        }

        // Tab Switching
        function switchTab(tab) {
            state.activeTab = tab;
            render();
        }

        // Itinerary Toggle
        function toggleDay(day) {
            state.expandedDay = state.expandedDay === day ? null : day;
            render();
        }

        // Packing List Toggle
        function toggleItem(item) {
            if (state.checkedItems.has(item)) {
                state.checkedItems.delete(item);
            } else {
                state.checkedItems.add(item);
            }
            render();
        }

        // Currency Calculation
        function fetchRate() {
            // Set Loading UI
            state.currency.loading = true;
            render(); // Re-render to show spinner

            // Force min loading time for UX (500ms)
            const minTime = new Promise(resolve => setTimeout(resolve, 500));
            
            // Fetch Data
            const fetchData = fetch(`https://api.exchangerate-api.com/v4/latest/EGP?t=${new Date().getTime()}`)
                .then(res => res.json())
                .then(data => {
                    const egpToTwd = data.rates.TWD;
                    const egpToUsd = data.rates.USD;
                    
                    if (egpToUsd && egpToTwd) {
                        state.currency.rates.usdToEgp = parseFloat((1 / egpToUsd).toFixed(2));
                        state.currency.rates.usdToTwd = parseFloat(((1 / egpToUsd) * egpToTwd).toFixed(2));
                        
                        // Recalculate current values if inputs exist
                        if (state.currency.usd) handleCurrencyChange('usd', state.currency.usd);
                        else if (state.currency.egp) handleCurrencyChange('egp', state.currency.egp);
                        else if (state.currency.twd) handleCurrencyChange('twd', state.currency.twd);
                    }
                })
                .catch(err => {
                    console.log("API Error, using default rates");
                    // Optionally show error to user
                });

            // Wait for both
            Promise.all([minTime, fetchData]).finally(() => {
                state.currency.loading = false;
                render();
            });
        }

        function handleCurrencyChange(type, value) {
            state.currency[type] = value;
            if (value === '') {
                state.currency.usd = '';
                state.currency.egp = '';
                state.currency.twd = '';
            } else {
                const num = parseFloat(value);
                if (!isNaN(num)) {
                    if (type === 'usd') {
                        state.currency.egp = (num * state.currency.rates.usdToEgp).toFixed(1);
                        state.currency.twd = (num * state.currency.rates.usdToTwd).toFixed(1);
                    } else if (type === 'egp') {
                        const usdVal = num / state.currency.rates.usdToEgp;
                        state.currency.usd = usdVal.toFixed(2);
                        state.currency.twd = (usdVal * state.currency.rates.usdToTwd).toFixed(1);
                    } else if (type === 'twd') {
                        const usdVal = num / state.currency.rates.usdToTwd;
                        state.currency.usd = usdVal.toFixed(2);
                        state.currency.egp = (usdVal * state.currency.rates.usdToEgp).toFixed(1);
                    }
                }
            }
            
            // Safe update input values if elements exist
            const elUsd = document.getElementById('input-usd');
            const elEgp = document.getElementById('input-egp');
            const elTwd = document.getElementById('input-twd');
            
            if(elUsd) elUsd.value = state.currency.usd;
            if(elEgp) elEgp.value = state.currency.egp;
            if(elTwd) elTwd.value = state.currency.twd;
        }

        function updateRate(type, value) {
            const val = parseFloat(value);
            state.currency.rates[type] = val;
            // Trigger recalculation based on USD if present
            if (state.currency.usd && !isNaN(val)) {
                handleCurrencyChange('usd', state.currency.usd);
            }
        }


        // --- Render Helpers (Templates) ---

        function renderHome() {
            const gradient = state.darkMode 
                ? 'bg-gradient-to-br from-slate-800 to-slate-900' 
                : 'bg-gradient-to-r from-amber-500 to-orange-600';
            
            const alertBg = state.darkMode ? 'bg-orange-900/20 border-orange-800/30 text-orange-200/80' : 'bg-orange-50 border-orange-100 text-orange-700';

            return `
                <div class="space-y-6 animate-fadeIn">
                    <div class="rounded-2xl p-6 text-white shadow-lg relative overflow-hidden transition-all duration-500 ${gradient}">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-2xl"></div>
                        <div class="absolute bottom-0 left-0 w-24 h-24 bg-black/10 rounded-full translate-y-1/2 -translate-x-1/2 blur-2xl"></div>

                        <h2 class="text-3xl font-bold mb-2 tracking-tight relative z-10">2026 ä¸€ç”Ÿå¿…å»åŸƒåŠè¡Œ</h2>
                        <div class="flex flex-col gap-1 relative z-10">
                            <p class="opacity-90 flex items-center gap-2 text-sm"><i data-lucide="calendar" class="w-4 h-4"></i> 2026/12/25 - 2027/1/2</p>
                            <p class="opacity-90 flex items-center gap-2 text-sm"><i data-lucide="users" class="w-4 h-4"></i> ç›®å‰åœ˜å“¡: ${tripDetails.currentPax} äºº</p>
                        </div>
                        
                        <div class="mt-6 bg-white/20 rounded-xl p-4 backdrop-blur-md border border-white/10 relative z-10">
                            <p class="text-xs font-bold uppercase tracking-widest opacity-80 mb-2 text-amber-100">Flight Info</p>
                            <div class="flex items-center gap-4">
                                <div class="p-2 bg-white/20 rounded-full">
                                    <i data-lucide="plane" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-xl tracking-wide">TK690</p>
                                    <p class="text-sm opacity-90">12/25 09:20 æŠµé”é–‹ç¾…</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 rounded-xl shadow-sm border-l-4 border-amber-500 ${state.darkMode ? 'bg-slate-800 text-gray-100' : 'bg-white'}">
                            <div class="text-amber-500 font-bold text-2xl mb-1">9 å¤©</div>
                            <div class="text-sm font-medium opacity-70">ç²¾å½©è¡Œç¨‹</div>
                        </div>
                        <div class="p-4 rounded-xl shadow-sm border-l-4 border-blue-500 ${state.darkMode ? 'bg-slate-800 text-gray-100' : 'bg-white'}">
                            <div class="text-blue-500 font-bold text-2xl mb-1">2 æ®µ</div>
                            <div class="text-sm font-medium opacity-70">åœ‹å…§é£›æ©Ÿ</div>
                        </div>
                    </div>

                    <div class="rounded-xl p-5 border ${alertBg}">
                        <h3 class="font-bold flex items-center gap-2 mb-3 ${state.darkMode ? 'text-orange-300' : 'text-orange-800'}">
                            <i data-lucide="alert-triangle" class="w-5 h-5"></i> é‡è¦æé†’
                        </h3>
                        <ul class="list-disc list-inside text-sm space-y-2 leading-relaxed opacity-90">
                            <li>åœ‹å…§èˆªç­è¡Œæé™åˆ¶ï¼š<span class="font-bold">è¨—é‹ 23KG + æ‰‹æ 7KG</span>ã€‚</li>
                            <li>è«‹æ–¼å‡ºç™¼å‰ç¢ºèªè½åœ°ç°½è²»ç”¨ (25 USD)ã€‚</li>
                            <li>æ²™æ¼ æ—©æ™šæº«å·®æ¥µå¤§ (0-25Â°C)ï¼Œè«‹å‚™å¦¥ä¿æš–è¡£ç‰©ã€‚</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function renderItinerary() {
            const isDark = state.darkMode;
            
            let html = `
                <div class="space-y-4">
                    <div class="text-xs text-center text-gray-400 mb-2 flex items-center justify-center gap-1">
                        <i data-lucide="info" class="w-3 h-3"></i> é»æ“Šå¡ç‰‡å¯æŸ¥çœ‹æ™¯é»è©³æƒ…
                    </div>
            `;

            itinerary.forEach((item, idx) => {
                const isExpanded = state.expandedDay === item.day;
                const containerClass = isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100';
                const containerHover = isDark ? 'hover:border-amber-500' : 'hover:border-amber-200';
                const activeBorder = isExpanded ? 'border-amber-400 ring-1 ring-amber-400 shadow-md' : `${containerClass} ${containerHover}`;
                
                const headerBg = isExpanded 
                    ? (isDark ? 'bg-amber-900/20 border-amber-800/30' : 'bg-amber-50 border-amber-100')
                    : (isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-50');

                const badgeBg = isExpanded 
                    ? (isDark ? 'bg-amber-800 text-amber-100' : 'bg-amber-100 text-amber-700')
                    : (isDark ? 'bg-slate-700 text-slate-300' : 'bg-gray-100 text-gray-500');

                html += `
                    <div onclick="toggleDay(${item.day})" class="rounded-xl shadow-sm overflow-hidden border transition-all duration-300 cursor-pointer relative ${activeBorder}">
                        ${item.isFlight && !isExpanded ? `<div class="absolute top-0 right-0 bg-blue-500 text-white text-[10px] px-2 py-0.5 rounded-bl-lg font-bold z-10">âœˆï¸ æ­æ©Ÿæ—¥</div>` : ''}
                        
                        <div class="p-4 flex justify-between items-center border-b transition-colors ${headerBg}">
                            <div class="flex items-center gap-3">
                                <div class="p-2 rounded-lg transition-colors ${badgeBg}">
                                    <span class="font-bold font-mono text-sm">Day ${item.day}</span>
                                </div>
                                <span class="text-xs font-medium text-gray-400">${item.date}</span>
                            </div>
                            <i data-lucide="${isExpanded ? 'chevron-up' : 'chevron-down'}" class="w-4 h-4 text-gray-400"></i>
                        </div>

                        <div class="p-0">
                            ${isExpanded ? `
                                <div class="w-full h-48 overflow-hidden relative group bg-gray-200 ${isDark ? 'bg-slate-700' : ''}">
                                    <img src="${item.image}" alt="${item.title}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <div class="hidden absolute inset-0 flex items-center justify-center bg-gray-100 text-gray-400 flex-col">
                                        <i data-lucide="image-off" class="w-6 h-6 mb-1"></i>
                                        <span class="text-xs">Image unavailable</span>
                                    </div>
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex items-end p-4">
                                        <p class="text-white text-xs font-medium bg-black/30 backdrop-blur-sm px-2 py-1 rounded border border-white/20">
                                            ${item.highlight.split('ã€')[0]}
                                        </p>
                                    </div>
                                </div>
                            ` : ''}

                            <div class="p-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-lg transition-colors ${isExpanded ? (isDark ? 'text-amber-400' : 'text-amber-700') : (isDark ? 'text-gray-100' : 'text-gray-800')}">
                                        ${item.title}
                                    </h3>
                                    ${!isExpanded ? `<div class="p-1.5 rounded-full ${isDark ? 'bg-slate-700 text-gray-400' : 'bg-gray-50 text-gray-400'}"><i data-lucide="${item.icon}" class="w-4 h-4"></i></div>` : ''}
                                </div>

                                ${item.isFlight ? `
                                    <div class="mb-3 p-2 rounded-lg flex items-center gap-3 text-sm ${isDark ? 'bg-blue-900/20 border border-blue-800 text-blue-300' : 'bg-blue-50 border border-blue-100 text-blue-800'}">
                                        <div class="p-1.5 rounded-full ${isDark ? 'bg-blue-800' : 'bg-blue-200'}">
                                            <i data-lucide="plane" class="w-4 h-4 ${isDark ? 'text-blue-100' : 'text-blue-700'}"></i>
                                        </div>
                                        <div>
                                            <p class="font-bold text-xs opacity-70">åœ‹å…§èˆªç­</p>
                                            <p class="font-bold">${item.flightInfo}</p>
                                        </div>
                                    </div>
                                ` : ''}

                                <p class="text-sm font-medium mb-2 ${isDark ? 'text-amber-500' : 'text-amber-600'}">${item.highlight}</p>
                                <p class="text-sm leading-relaxed mb-3 ${isDark ? 'text-gray-300' : 'text-gray-600'}">${item.desc}</p>

                                ${isExpanded ? `
                                    <div class="mt-4 pt-4 border-t animate-fadeIn ${isDark ? 'border-slate-700' : 'border-gray-100'}">
                                        ${item.importantNote ? `
                                            <div class="mb-4 p-3 border-l-4 rounded-r text-sm flex gap-2 ${isDark ? 'bg-red-900/20 border-red-500 text-red-300' : 'bg-red-50 border-red-500 text-red-700'}">
                                                <i data-lucide="alert-triangle" class="w-4 h-4 mt-0.5 shrink-0"></i>
                                                <span>${item.importantNote}</span>
                                            </div>
                                        ` : ''}

                                        <h4 class="text-xs font-bold uppercase tracking-wider mb-2 ${isDark ? 'text-slate-500' : 'text-gray-400'}">é—œæ–¼æ­¤åœ°</h4>
                                        <p class="text-sm italic leading-relaxed mb-4 ${isDark ? 'text-slate-400' : 'text-gray-500'}">${item.details}</p>
                                        
                                        <a href="${item.link}" target="_blank" onclick="event.stopPropagation()" class="inline-flex items-center gap-2 text-xs font-bold px-3 py-2 rounded-lg transition-colors ${isDark ? 'text-blue-400 hover:text-blue-300 bg-blue-900/30' : 'text-blue-500 hover:text-blue-600 bg-blue-50'}">
                                            <i data-lucide="external-link" class="w-3 h-3"></i> æŸ¥çœ‹è©³ç´°ä»‹ç´¹
                                        </a>

                                        <div class="mt-4 grid grid-cols-2 gap-2 text-xs ${isDark ? 'text-slate-400' : 'text-gray-500'}">
                                            <div class="flex items-center gap-2 p-2 rounded ${isDark ? 'bg-slate-700/50' : 'bg-gray-50'}">
                                                <i data-lucide="moon" class="w-3 h-3"></i> ä½: ${item.stay}
                                            </div>
                                            <div class="flex items-center gap-2 p-2 rounded ${isDark ? 'bg-slate-700/50' : 'bg-gray-50'}">
                                                <i data-lucide="coffee" class="w-3 h-3"></i> é£Ÿ: ${item.meals}
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            return html;
        }

        function renderCosts() {
            const isDark = state.darkMode;
            const cardClass = isDark ? 'bg-slate-800' : 'bg-white';
            const textClass = isDark ? 'text-gray-100' : 'text-gray-800';
            const subTextClass = isDark ? 'text-gray-300' : 'text-gray-600';

            let html = `
                <div class="space-y-6">
                    <div class="rounded-xl shadow-sm p-5 border-t-4 border-green-500 ${cardClass}">
                        <h3 class="text-lg font-bold mb-4 flex items-center gap-2 ${textClass}">
                            <i data-lucide="credit-card" class="w-5 h-5 text-green-600"></i> åœ˜è²»å ±åƒ¹
                        </h3>
                        <div class="space-y-3">
            `;
            
            costs.tiers.forEach(tier => {
                const isActive = tier.pax.includes(tripDetails.currentPax.toString());
                const bg = isActive 
                    ? (isDark ? 'bg-green-900/20 border-green-500 ring-1 ring-green-500' : 'bg-green-50 border-green-500 ring-1 ring-green-500')
                    : (isDark ? 'bg-slate-700/50 border-slate-700' : 'bg-gray-50 border-gray-100');
                
                html += `
                    <div class="flex justify-between items-center p-3 rounded-lg border transition-colors ${bg}">
                        <span class="font-bold ${textClass}">${tier.pax}</span>
                        <div class="text-right">
                            <div class="font-bold ${isDark ? 'text-green-400' : 'text-green-700'}">${tier.price}</div>
                            <div class="text-xs text-gray-400">${tier.twd}</div>
                        </div>
                    </div>
                `;
            });

            html += `
                        </div>
                        <p class="text-xs text-gray-400 mt-3 text-center">* ç›®å‰åœ˜å“¡ 15 äººï¼Œé©ç”¨ 14 äººå ±åƒ¹ç´šè·ã€‚</p>
                    </div>

                    <div class="rounded-xl shadow-sm p-5 ${cardClass}">
                        <h3 class="font-bold mb-3 ${textClass}">è²»ç”¨åŒ…å«</h3>
                        <ul class="space-y-2">
            `;
            costs.included.forEach(item => {
                html += `
                    <li class="flex items-start gap-2 text-sm ${subTextClass}">
                        <i data-lucide="check-circle" class="w-4 h-4 text-green-500 mt-0.5 shrink-0"></i>
                        <span>${item}</span>
                    </li>
                `;
            });
            html += `</ul></div>`;

            html += `
                    <div class="rounded-xl shadow-sm p-5 ${cardClass}">
                        <h3 class="font-bold mb-3 ${textClass}">è²»ç”¨ä¸å«</h3>
                        <ul class="space-y-2">
            `;
             costs.excluded.forEach(item => {
                html += `
                    <li class="flex items-start gap-2 text-sm ${subTextClass}">
                         <div class="w-4 h-4 rounded-full border border-red-400 flex items-center justify-center mt-0.5 flex-shrink-0">
                            <div class="w-2 h-0.5 bg-red-400"></div>
                        </div>
                        <span>${item}</span>
                    </li>
                `;
            });
            html += `</ul></div></div>`;

            return html;
        }

        function renderCurrency() {
            const isDark = state.darkMode;
            const cardClass = isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100';
            const inputBg = isDark ? 'bg-slate-700/50' : 'bg-gray-50';
            const textClass = isDark ? 'text-gray-100' : 'text-gray-800';

            return `
                <div class="space-y-6">
                    <div class="rounded-xl shadow-sm p-6 border ${cardClass}">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-bold flex items-center gap-2 ${textClass}">
                                <i data-lucide="calculator" class="w-5 h-5 text-amber-500"></i> åŒ¯ç‡æ›ç®—
                            </h3>
                            <button onclick="fetchRate()" class="p-2 rounded-full transition-colors flex items-center justify-center ${isDark ? 'bg-slate-700 hover:bg-slate-600' : 'bg-gray-100 hover:bg-gray-200'}">
                                <i data-lucide="refresh-cw" class="w-4 h-4 ${state.currency.loading ? 'animate-spin' : ''} ${isDark ? 'text-gray-300' : 'text-gray-600'}"></i>
                            </button>
                        </div>

                        <div class="space-y-3">
                             <!-- USD -->
                            <div class="p-4 rounded-xl border border-transparent focus-within:border-green-400 transition-colors ${inputBg}">
                                <label class="text-xs font-bold uppercase tracking-wide block mb-1 ${isDark ? 'text-slate-400' : 'text-gray-400'}">ç¾é‡‘ (USD)</label>
                                <div class="flex items-center">
                                    <span class="text-xl font-bold text-green-600 mr-2">$</span>
                                    <input type="number" id="input-usd" value="${state.currency.usd}" oninput="handleCurrencyChange('usd', this.value)" placeholder="0" class="w-full bg-transparent text-2xl font-bold outline-none placeholder-gray-300 ${isDark ? 'text-white' : 'text-gray-800'}">
                                </div>
                            </div>
                            
                            <div class="flex justify-center -my-2 relative z-10">
                                <div class="p-1 rounded-full border shadow-sm ${isDark ? 'bg-slate-600 border-slate-500' : 'bg-white border-gray-100'}">
                                    <i data-lucide="arrow-down" class="w-3 h-3 text-gray-400"></i>
                                </div>
                            </div>

                            <!-- EGP -->
                            <div class="p-4 rounded-xl border border-transparent focus-within:border-amber-400 transition-colors ${inputBg}">
                                <label class="text-xs font-bold uppercase tracking-wide block mb-1 ${isDark ? 'text-slate-400' : 'text-gray-400'}">åŸƒåŠéŠ (EGP)</label>
                                <div class="flex items-center">
                                    <span class="text-xl font-bold text-amber-600 mr-2">EÂ£</span>
                                    <input type="number" id="input-egp" value="${state.currency.egp}" oninput="handleCurrencyChange('egp', this.value)" placeholder="0" class="w-full bg-transparent text-2xl font-bold outline-none placeholder-gray-300 ${isDark ? 'text-white' : 'text-gray-800'}">
                                </div>
                            </div>

                             <div class="flex justify-center -my-2 relative z-10">
                                <div class="p-1 rounded-full border shadow-sm ${isDark ? 'bg-slate-600 border-slate-500' : 'bg-white border-gray-100'}">
                                    <i data-lucide="arrow-down" class="w-3 h-3 text-gray-400"></i>
                                </div>
                            </div>

                            <!-- TWD -->
                            <div class="p-4 rounded-xl border border-transparent focus-within:border-blue-400 transition-colors ${inputBg}">
                                <label class="text-xs font-bold uppercase tracking-wide block mb-1 ${isDark ? 'text-slate-400' : 'text-gray-400'}">æ–°å°å¹£ (TWD)</label>
                                <div class="flex items-center">
                                    <span class="text-xl font-bold text-blue-600 mr-2">NT$</span>
                                    <input type="number" id="input-twd" value="${state.currency.twd}" oninput="handleCurrencyChange('twd', this.value)" placeholder="0" class="w-full bg-transparent text-2xl font-bold outline-none placeholder-gray-300 ${isDark ? 'text-white' : 'text-gray-800'}">
                                </div>
                            </div>
                        </div>

                         <div class="mt-6 pt-4 border-t space-y-3 ${isDark ? 'border-slate-700' : 'border-gray-100'}">
                            <div class="flex justify-between items-center text-sm ${isDark ? 'text-slate-400' : 'text-gray-500'}">
                                <span class="font-bold">åŒ¯ç‡è¨­å®š (å¯æ‰‹å‹•ä¿®æ”¹)</span>
                            </div>

                            <div class="flex items-center justify-between p-2 rounded-lg ${isDark ? 'bg-slate-900/50' : 'bg-gray-50'}">
                                <span class="text-xs ${isDark ? 'text-slate-400' : 'text-gray-500'}">1 ç¾é‡‘ (USD) â‰ˆ </span>
                                <div class="flex items-center gap-1">
                                    <input type="number" value="${state.currency.rates.usdToEgp}" step="0.1" onchange="updateRate('usdToEgp', this.value)" class="rounded px-2 py-1 w-20 text-center font-bold outline-none ${isDark ? 'bg-slate-800 border-slate-600 text-amber-500' : 'bg-white border border-gray-200 text-amber-600'}">
                                    <span class="text-xs font-bold w-8 ${isDark ? 'text-slate-400' : 'text-gray-500'}">EGP</span>
                                </div>
                            </div>
                             <div class="flex items-center justify-between p-2 rounded-lg ${isDark ? 'bg-slate-900/50' : 'bg-gray-50'}">
                                <span class="text-xs ${isDark ? 'text-slate-400' : 'text-gray-500'}">1 ç¾é‡‘ (USD) â‰ˆ </span>
                                <div class="flex items-center gap-1">
                                    <input type="number" value="${state.currency.rates.usdToTwd}" step="0.1" onchange="updateRate('usdToTwd', this.value)" class="rounded px-2 py-1 w-20 text-center font-bold outline-none ${isDark ? 'bg-slate-800 border-slate-600 text-blue-500' : 'bg-white border border-gray-200 text-blue-600'}">
                                    <span class="text-xs font-bold w-8 ${isDark ? 'text-slate-400' : 'text-gray-500'}">TWD</span>
                                </div>
                            </div>
                             <div class="text-center mt-2">
                                <p class="text-[10px] text-gray-400">
                                * æ¨ç®—åŒ¯ç‡: 1 åŸƒéŠ (EGP) â‰ˆ <span class="font-bold ${isDark ? 'text-gray-300' : 'text-gray-500'}">${(state.currency.rates.usdToTwd / state.currency.rates.usdToEgp).toFixed(3)}</span> å°å¹£
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGuide() {
            const isDark = state.darkMode;
            let html = '<div class="space-y-6 pb-20">';
            
            guides.forEach(guide => {
                html += `
                    <div class="rounded-xl shadow-sm p-5 border-l-4 transition-all ${isDark ? 'bg-slate-800 border-slate-600 hover:border-amber-500' : 'bg-white border-gray-200 hover:border-amber-400'}">
                        <div class="flex items-center gap-3 mb-3">
                            <div class="p-2 rounded-full ${isDark ? 'bg-slate-700' : 'bg-gray-50'}">
                                <i data-lucide="${guide.icon}" class="w-5 h-5 ${guide.color}"></i>
                            </div>
                            <h3 class="font-bold ${isDark ? 'text-gray-100' : 'text-gray-800'}">${guide.title}</h3>
                        </div>
                        <p class="text-sm whitespace-pre-line leading-relaxed pl-2 ${isDark ? 'text-gray-300' : 'text-gray-600'}">${guide.content}</p>
                    </div>
                `;
            });

            html += `
                <div class="rounded-xl shadow-sm p-5 ${isDark ? 'bg-slate-800' : 'bg-white'}">
                    <h3 class="font-bold mb-4 flex items-center gap-2 ${isDark ? 'text-gray-100' : 'text-gray-800'}">
                        <i data-lucide="shopping-bag" class="w-5 h-5 ${isDark ? 'text-amber-500' : 'text-amber-600'}"></i> è¡Œææ¸…å–®æª¢æŸ¥è¡¨
                    </h3>
            `;
            
            packingList.forEach((cat, idx) => {
                html += `
                    <div class="mb-4 last:mb-0">
                        <h4 class="text-xs font-bold mb-2 uppercase tracking-wide ${isDark ? 'text-slate-400' : 'text-gray-500'}">${cat.category}</h4>
                `;
                cat.items.forEach(item => {
                    const checked = state.checkedItems.has(item);
                    const bgClass = checked 
                        ? (isDark ? 'bg-green-900/20 border-green-800' : 'bg-green-50/50 border-green-200')
                        : (isDark ? 'bg-slate-800 border-slate-700' : 'bg-white border-gray-100 hover:border-amber-200');
                    const textClass = checked
                        ? (isDark ? 'text-gray-500 line-through' : 'text-gray-400 line-through')
                        : (isDark ? 'text-gray-200' : 'text-gray-700');
                    const iconBg = checked ? 'bg-green-500 border-green-500' : (isDark ? 'border-slate-500' : 'border-gray-300');

                    html += `
                        <div onclick="toggleItem('${item}')" class="flex items-center p-3 mb-2 rounded-lg cursor-pointer border transition-all duration-200 ${bgClass}">
                            <div class="w-5 h-5 rounded-full border flex items-center justify-center mr-3 transition-colors ${iconBg}">
                                ${checked ? '<i data-lucide="check" class="w-3 h-3 text-white"></i>' : ''}
                            </div>
                            <span class="transition-colors ${textClass}">${item}</span>
                        </div>
                    `;
                });
                html += `</div>`;
            });

            html += `</div></div>`;
            return html;
        }

        // --- Main Render Function ---
        function render() {
            const mainContent = document.getElementById('main-content');
            const bottomNav = document.getElementById('bottom-nav');
            const isDark = state.darkMode;

            // Render Nav
            const navItems = [
                { id: 'home', icon: 'info', label: 'æ¦‚è¦½' },
                { id: 'itinerary', icon: 'map', label: 'è¡Œç¨‹' },
                { id: 'currency', icon: 'calculator', label: 'åŒ¯ç‡' },
                { id: 'costs', icon: 'credit-card', label: 'è²»ç”¨' },
                { id: 'guide', icon: 'briefcase', label: 'æ”»ç•¥' }
            ];

            bottomNav.innerHTML = navItems.map(item => {
                const isActive = state.activeTab === item.id;
                const color = isActive 
                    ? (isDark ? 'text-amber-400 font-bold' : 'text-amber-600 font-bold')
                    : (isDark ? 'text-slate-500' : 'text-gray-400');
                return `
                    <button onclick="switchTab('${item.id}')" class="flex flex-col items-center gap-1 transition-colors ${color}">
                        <i data-lucide="${item.icon}" class="w-5 h-5"></i>
                        ${item.label}
                    </button>
                `;
            }).join('');


            // Render Content
            if (state.activeTab === 'home') mainContent.innerHTML = renderHome();
            else if (state.activeTab === 'itinerary') mainContent.innerHTML = renderItinerary();
            else if (state.activeTab === 'costs') mainContent.innerHTML = renderCosts();
            else if (state.activeTab === 'currency') mainContent.innerHTML = renderCurrency();
            else if (state.activeTab === 'guide') mainContent.innerHTML = renderGuide();

            // Initialize Icons
            lucide.createIcons();
            
            // Apply font button visual state
            const btn = document.getElementById('font-btn');
            if(btn) btn.innerHTML = state.fontLevel === 0 ? 'A' : (state.fontLevel === 1 ? 'A+' : 'A++');
        }

        // --- Init ---
        // Fetch rates on load
        fetchRate();
        render();

    </script>
</body>
</html>
